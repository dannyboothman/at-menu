/*
 * At Menu
 * Copyright 2023 Daniel Boothman
 * www.atmenujs.com
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e(t)):"object"==typeof exports?module.exports=e(t):t.AtMenu=e(t)}("undefined"!=typeof global?global:this.window||this.global,(function(t){"use strict";var e={},n={target:"",menu:"",items:".atm-item",openMenu:"@",closeMenu:"Escape",marginTop:20},r=function(){var t={},e=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var o=function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=r(!0,t[i],n[i]):t[i]=n[i])};n<i;n++){var a=arguments[n];o(a)}return t},i=function(t){t.menu.classList.remove("atm-menu-active")},o=function(t){var e=document.querySelector(".atm-item-active");if(e){var n=e.offsetTop;t.menu.scrollTo({top:n})}},a=function(t){var e=null;const n=t.target.value,r=n.indexOf(t.openMenu);if(r>=0){const i=t.target.selectionStart;e=n.substring(r+1,i)}return e},s=function(t,e,n){var r=document.querySelectorAll(e.items),i=!1;null!=document.querySelector(".atm-item-active")&&document.querySelector(".atm-item-active").classList.remove("atm-item-active");for(var a=0;a<r.length;a++){r[a].innerText.toLowerCase().includes(t.toLowerCase())?(r[a].classList.remove("atm-item-inactive"),0==i&&(i=!0,r[a].classList.add("atm-item-active"))):r[a].classList.add("atm-item-inactive")}0==i&&null!=document.querySelector(".atm-item-active")&&document.querySelector(".atm-item-active").classList.remove("atm-item-active"),o(e)};e.getCaretPosition=function(t){return{caret:$(t).textareaHelper("caretPos"),target:t.getBoundingClientRect(),html:document.querySelector("html").scrollTop}},e.onChooseRun=function(t,e){if(console.log(t),console.log(e),"object"!=typeof(r=t)||null===r||Array.isArray(r)){t=c.find((e=>e.targetId==t));var n=e}else n=t.menu.querySelector(".atm-item-active");var r,i={settings:t,event:event,target:t.target,selectedItem:n,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onChoose(i)},e.insertContent=function(t,e,n=!0){var r=t.settings,o=r.target.value;const a=o.indexOf(r.openMenu),s=r.target.selectionStart,c=`${e}`,u=o.substring(0,a)+c+o.substring(s);r.target.value=u,i(r);let l=r.target.value.indexOf(c);l+=c.length,r.target.focus(),r.target.setSelectionRange(l,l)};var c=new Array;return e.init=function(t){var e=r(n,t||{});e.targetId=t.target,e.menuId=t.menu,e.target=document.querySelector(t.target),e.menu=document.querySelector(t.menu),c.push(e),".atm-item"==e.items&&function(t){for(var e=t.menu.children,n=0;n<e.length;n++)e[n].classList.add("atm-item")}(e),null!=e.onChoose&&function(t){var e=document.querySelectorAll(t.items);[].forEach.call(e,(function(e){e.setAttribute("onclick","AtMenu.onChooseRun('"+t.targetId+"', this)")}))}(e),e.target.addEventListener("input",(function(t){!function(t,e){if(t.target.value[t.target.selectionStart-1]===t.openMenu){var r=AtMenu.getCaretPosition(t.target),i=n.marginTop;t.marginTop&&(i=t.marginTop),t.menu.style.top=r.caret.top+r.target.top+r.html+i+"px",t.menu.style.left=r.caret.left+r.target.left+"px",t.menu.classList.add("atm-menu-active")}}(e),function(t,e){var n=a(t);null!=n&&s(n,t,e)}(e,t)}),!1),e.target.addEventListener("keydown",(function(t){e.menu.classList.contains("atm-menu-active")&&(function(t,e){e.code==t.closeMenu&&t.menu.classList.remove("atm-menu-active")}(e,t),function(t,e){null!=t.onChoose&&(13!=e.keyCode&&"Enter"!=e.key&&"insertLineBreak"!=e.inputType||(e.preventDefault(),AtMenu.onChooseRun(t)))}(e,t),function(t,e){8!=e.keyCode&&"Backspace"!=e.key||t.target.value[t.target.selectionStart-1]===t.openMenu&&i(t)}(e,t),function(t,e){if(38==e.keyCode||"ArrowUp"==e.key){e.preventDefault();var n=document.querySelector(".atm-item-active");if(n){var r=n.previousElementSibling;r&&(n.classList.remove("atm-item-active"),r.classList.add("atm-item-active"))}o(t)}}(e,t),function(t,e){if(40==e.keyCode||"ArrowDown"==e.key){e.preventDefault();var n=document.querySelector(".atm-item-active");if(n){var r=n.nextElementSibling;r&&(n.classList.remove("atm-item-active"),r.classList.add("atm-item-active"))}o(t)}}(e,t))}),!1)},e})),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}((function(t){"use strict";var e="textarea-helper-caret",n="textarea-helper",r=["box-sizing","height","width","padding-bottom","padding-left","padding-right","padding-top","font-family","font-size","font-style","font-variant","font-weight","word-spacing","letter-spacing","line-height","text-decoration","text-indent","text-transform","direction"],i=function(e){"textarea"===e.nodeName.toLowerCase()&&(this.$text=t(e),this.$mirror=t("<div/>").css({position:"absolute",overflow:"auto","white-space":"pre-wrap","word-wrap":"break-word",top:0,left:-9999}).insertAfter(this.$text))};(function(){this.update=function(){for(var n,i={},o=0;n=r[o];o++)i[n]=this.$text.css(n);this.$mirror.css(i).empty();var a=this.getOriginalCaretPos(),s=this.$text.val(),c=document.createTextNode(s.substring(0,a)),u=document.createTextNode(s.substring(a)),l=t("<span/>").addClass(e).css("position","absolute").html("&nbsp;");this.$mirror.append(c,l,u).scrollTop(this.$text.scrollTop())},this.destroy=function(){return this.$mirror.remove(),this.$text.removeData(n),null},this.caretPos=function(){this.update();var t=this.$mirror.find("."+e),n=t.position();return"rtl"===this.$text.css("direction")&&(n.right=this.$mirror.innerWidth()-n.left-t.width(),n.left="auto"),n},this.height=function(){return this.update(),this.$mirror.css("height",""),this.$mirror.height()},this.getOriginalCaretPos=function(){var t=this.$text[0];if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var n=t.createTextRange(),r=n.duplicate();return n.moveToBookmark(e.getBookmark()),r.setEndPoint("EndToStart",n),r.text.length}return 0}}).call(i.prototype),t.fn.textareaHelper=function(e){return this.each((function(){var e=t(this),r=e.data(n);r||(r=new i(this),e.data(n,r))})),e?this.first().data(n)[e]():this}}));