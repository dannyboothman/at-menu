/*
 * At Menu
 * Copyright 2023 Daniel Boothman
 * www.atmenujs.com
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e(t)):"object"==typeof exports?module.exports=e(t):t.AtMenu=e(t)}("undefined"!=typeof global?global:this.window||this.global,(function(t){"use strict";var e={},n={target:"",menu:"",items:".atm-item",openMenu:"@",closeMenu:"Escape",marginTop:20},o=function(){var t={},e=!1,n=0,r=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var i=function(n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e&&"[object Object]"===Object.prototype.toString.call(n[r])?t[r]=o(!0,t[r],n[r]):t[r]=n[r])};n<r;n++){var a=arguments[n];i(a)}return t},r=function(t){t.menu.classList.remove("atm-menu-active"),null!=t.onClose&&AtMenu.onCloseRun(t)},i=function(t){var e=document.querySelector(".atm-item-active");if(e){var n=e.offsetTop;t.menu.scrollTo({top:n})}},a=function(t){var e=null;const n=t.target.value,o=n.indexOf(t.openMenu);if(o>=0){const r=t.target.selectionStart;e=n.substring(o+1,r)}return e},s=function(t,e,n){var o=document.querySelectorAll(e.items),r=!1;null!=document.querySelector(".atm-item-active")&&document.querySelector(".atm-item-active").classList.remove("atm-item-active");for(var a=0;a<o.length;a++){o[a].innerText.toLowerCase().includes(t.toLowerCase())?(o[a].classList.remove("atm-item-inactive"),0==r&&(r=!0,o[a].classList.add("atm-item-active"))):o[a].classList.add("atm-item-inactive")}0==r&&null!=document.querySelector(".atm-item-active")&&document.querySelector(".atm-item-active").classList.remove("atm-item-active"),i(e)};e.getCaretPosition=function(t){return{caret:$(t).textareaHelper("caretPos"),target:t.getBoundingClientRect(),html:document.querySelector("html").scrollTop}},e.onChooseRun=function(t,e){if("object"!=typeof(o=t)||null===o||Array.isArray(o)){t=c.find((e=>e.targetId==t));var n=e}else n=t.menu.querySelector(".atm-item-active");var o,r={settings:t,event:event,target:t.target,selectedItem:n,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onChoose(r)},e.onOpenRun=function(t){var e={settings:t,event:event,target:t.target,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onOpen(e)},e.onCloseRun=function(t){var e={settings:t,event:event,target:t.target,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onClose(e)},e.insertContent=function(t,e,n=!0){var o=t.settings,i=o.target.value;const a=i.indexOf(o.openMenu),s=o.target.selectionStart,c=`${e}`,u=i.substring(0,a)+c+i.substring(s);o.target.value=u,r(o);let l=o.target.value.indexOf(c);l+=c.length,o.target.focus(),o.target.setSelectionRange(l,l)};var c=new Array;return e.init=function(t){var e=o(n,t||{});e.targetId=t.target,e.menuId=t.menu,e.target=document.querySelector(t.target),e.menu=document.querySelector(t.menu),c.push(e),".atm-item"==e.items&&function(t){for(var e=t.menu.children,n=0;n<e.length;n++)e[n].classList.add("atm-item")}(e),null!=e.onChoose&&function(t){var e=document.querySelectorAll(t.items);[].forEach.call(e,(function(e){e.setAttribute("onclick","AtMenu.onChooseRun('"+t.targetId+"', this)")}))}(e),e.target.addEventListener("input",(function(t){!function(t,e){if(t.target.value[t.target.selectionStart-1]===t.openMenu){var o=AtMenu.getCaretPosition(t.target),r=n.marginTop;t.marginTop&&(r=t.marginTop),t.menu.style.top=o.caret.top+o.target.top+o.html+r+"px",t.menu.style.left=o.caret.left+o.target.left+"px",t.menu.classList.add("atm-menu-active"),null!=t.onOpen&&AtMenu.onOpenRun(t)}}(e),function(t,e){var n=a(t);null!=n&&s(n,t,e)}(e,t)}),!1),e.target.addEventListener("keydown",(function(t){e.menu.classList.contains("atm-menu-active")&&(function(t,e){e.code==t.closeMenu&&(t.menu.classList.remove("atm-menu-active"),null!=t.onClose&&AtMenu.onCloseRun(t))}(e,t),function(t,e){null!=t.onChoose&&(13!=e.keyCode&&"Enter"!=e.key&&"insertLineBreak"!=e.inputType||(e.preventDefault(),AtMenu.onChooseRun(t)))}(e,t),function(t,e){8!=e.keyCode&&"Backspace"!=e.key||t.target.value[t.target.selectionStart-1]===t.openMenu&&r(t)}(e,t),function(t,e){if(38==e.keyCode||"ArrowUp"==e.key){e.preventDefault();var n=document.querySelector(".atm-item-active");if(n){var o=n.previousElementSibling;o&&(n.classList.remove("atm-item-active"),o.classList.add("atm-item-active"))}i(t)}}(e,t),function(t,e){if(40==e.keyCode||"ArrowDown"==e.key){e.preventDefault();var n=document.querySelector(".atm-item-active");if(n){var o=n.nextElementSibling;o&&(n.classList.remove("atm-item-active"),o.classList.add("atm-item-active"))}i(t)}}(e,t))}),!1)},e})),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}((function(t){"use strict";var e="textarea-helper-caret",n="textarea-helper",o=["box-sizing","height","width","padding-bottom","padding-left","padding-right","padding-top","font-family","font-size","font-style","font-variant","font-weight","word-spacing","letter-spacing","line-height","text-decoration","text-indent","text-transform","direction"],r=function(e){"textarea"===e.nodeName.toLowerCase()&&(this.$text=t(e),this.$mirror=t("<div/>").css({position:"absolute",overflow:"auto","white-space":"pre-wrap","word-wrap":"break-word",top:0,left:-9999}).insertAfter(this.$text))};(function(){this.update=function(){for(var n,r={},i=0;n=o[i];i++)r[n]=this.$text.css(n);this.$mirror.css(r).empty();var a=this.getOriginalCaretPos(),s=this.$text.val(),c=document.createTextNode(s.substring(0,a)),u=document.createTextNode(s.substring(a)),l=t("<span/>").addClass(e).css("position","absolute").html("&nbsp;");this.$mirror.append(c,l,u).scrollTop(this.$text.scrollTop())},this.destroy=function(){return this.$mirror.remove(),this.$text.removeData(n),null},this.caretPos=function(){this.update();var t=this.$mirror.find("."+e),n=t.position();return"rtl"===this.$text.css("direction")&&(n.right=this.$mirror.innerWidth()-n.left-t.width(),n.left="auto"),n},this.height=function(){return this.update(),this.$mirror.css("height",""),this.$mirror.height()},this.getOriginalCaretPos=function(){var t=this.$text[0];if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var n=t.createTextRange(),o=n.duplicate();return n.moveToBookmark(e.getBookmark()),o.setEndPoint("EndToStart",n),o.text.length}return 0}}).call(r.prototype),t.fn.textareaHelper=function(e){return this.each((function(){var e=t(this),o=e.data(n);o||(o=new r(this),e.data(n,o))})),e?this.first().data(n)[e]():this}}));