/*
 * At Menu
 * Copyright 2023 Daniel Boothman
 * www.atmenujs.com
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e(t)):"object"==typeof exports?module.exports=e(t):t.AtMenu=e(t)}("undefined"!=typeof global?global:this.window||this.global,(function(t){"use strict";var e={},n={target:"",menu:"",items:".atm-item",openMenu:"@",closeMenu:"Escape",marginTop:20},i=function(){var t={},e=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);for(var r=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e&&"[object Object]"===Object.prototype.toString.call(n[o])?t[o]=i(!0,t[o],n[o]):t[o]=n[o])};n<o;n++){var a=arguments[n];r(a)}return t},o=function(t){t.menu.classList.remove("atm-menu-active"),null!=t.onClose&&AtMenu.onCloseRun(t)},r=function(t){var e=document.querySelector(".atm-item-active");if(e){var n=e.offsetTop;t.menu.scrollTo({top:n})}},a=function(t){var e=null;const n=t.target.value,i=n.indexOf(t.openMenu);if(i>=0){const o=t.target.selectionStart;e=n.substring(i+1,o)}return e},s=function(t,e,n){var i=document.querySelectorAll(e.items),o=!1;null!=document.querySelector(".atm-item-active")&&document.querySelector(".atm-item-active").classList.remove("atm-item-active");for(var a=0;a<i.length;a++){i[a].innerText.toLowerCase().includes(t.toLowerCase())?(i[a].classList.remove("atm-item-inactive"),0==o&&(o=!0,i[a].classList.add("atm-item-active"))):i[a].classList.add("atm-item-inactive")}0==o&&null!=document.querySelector(".atm-item-active")&&document.querySelector(".atm-item-active").classList.remove("atm-item-active"),r(e)};e.getCaretPosition=function(t){return{caret:$(t).textareaHelper("caretPos"),target:t.getBoundingClientRect(),html:document.querySelector("html").scrollTop}},e.onChooseRun=function(t,e){if("object"!=typeof(i=t)||null===i||Array.isArray(i)){t=c.find((e=>e.targetId==t));var n=e}else n=t.menu.querySelector(".atm-item-active");var i,o={settings:t,event:event,target:t.target,selectedItem:n,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onChoose(o)},e.onOpenRun=function(t){var e={settings:t,event:event,target:t.target,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onOpen(e)},e.onCloseRun=function(t){var e={settings:t,event:event,target:t.target,typedText:a(t),caretPos:this.getCaretPosition(t.target)};t.onClose(e)},e.insertContent=function(t,e,n=!0){var i=t.settings,r=i.target.value;const a=r.indexOf(i.openMenu),s=i.target.selectionStart,c=`${e}`,u=r.substring(0,a)+c+r.substring(s);i.target.value=u,o(i);let l=i.target.value.indexOf(c);l+=c.length,i.target.focus(),i.target.setSelectionRange(l,l)};var c=new Array;return e.init=function(t){var e=i(n,t||{});e.targetId=t.target,e.menuId=t.menu,e.target=document.querySelector(t.target),e.menu=document.querySelector(t.menu),c.push(e),".atm-item"==e.items&&function(t){for(var e=t.menu.children,n=0;n<e.length;n++)e[n].classList.add("atm-item")}(e),null!=e.onChoose&&function(t){var e=document.querySelectorAll(t.items);[].forEach.call(e,(function(e){e.setAttribute("onclick","AtMenu.onChooseRun('"+t.targetId+"', this)")}))}(e),e.target.addEventListener("input",(function(t){!function(t,e){if(t.target.value[t.target.selectionStart-1]===t.openMenu){var i=AtMenu.getCaretPosition(t.target),o=n.marginTop;t.marginTop&&(o=t.marginTop),t.menu.style.top=i.caret.top+i.target.top+i.html+o+"px",t.menu.style.left=i.caret.left+i.target.left+"px",t.menu.classList.add("atm-menu-active"),null!=t.onOpen&&AtMenu.onOpenRun(t)}}(e),function(t,e){var n=a(t);null!=n&&s(n,t,e)}(e,t)}),!1),e.target.addEventListener("keydown",(function(t){e.menu.classList.contains("atm-menu-active")&&(function(t,e){e.code==t.closeMenu&&(t.menu.classList.remove("atm-menu-active"),null!=t.onClose&&AtMenu.onCloseRun(t))}(e,t),function(t,e){null!=t.onChoose&&(13!=e.keyCode&&"Enter"!=e.key&&"insertLineBreak"!=e.inputType||(e.preventDefault(),AtMenu.onChooseRun(t)))}(e,t),function(t,e){8!=e.keyCode&&"Backspace"!=e.key||t.target.value[t.target.selectionStart-1]===t.openMenu&&o(t)}(e,t),function(t,e){if(38==e.keyCode||"ArrowUp"==e.key){e.preventDefault();var n=document.querySelector(".atm-item-active");if(n){for(var i=n.previousElementSibling;i&&i.classList.contains("atm-item-inactive");)i=i.previousElementSibling;i&&(n.classList.remove("atm-item-active"),i.classList.add("atm-item-active"))}r(t)}}(e,t),function(t,e){if(40==e.keyCode||"ArrowDown"==e.key){e.preventDefault();var n=document.querySelector(".atm-item-active");if(n){for(var i=n.nextElementSibling;i&&i.classList.contains("atm-item-inactive");)i=i.nextElementSibling;i&&(n.classList.remove("atm-item-active"),i.classList.add("atm-item-active"))}r(t)}}(e,t))}),!1)},e})),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}((function(t){"use strict";var e="textarea-helper-caret",n="textarea-helper",i=["box-sizing","height","width","padding-bottom","padding-left","padding-right","padding-top","font-family","font-size","font-style","font-variant","font-weight","word-spacing","letter-spacing","line-height","text-decoration","text-indent","text-transform","direction"],o=function(e){"textarea"===e.nodeName.toLowerCase()&&(this.$text=t(e),this.$mirror=t("<div/>").css({position:"absolute",overflow:"auto","white-space":"pre-wrap","word-wrap":"break-word",top:0,left:-9999}).insertAfter(this.$text))};(function(){this.update=function(){for(var n,o={},r=0;n=i[r];r++)o[n]=this.$text.css(n);this.$mirror.css(o).empty();var a=this.getOriginalCaretPos(),s=this.$text.val(),c=document.createTextNode(s.substring(0,a)),u=document.createTextNode(s.substring(a)),l=t("<span/>").addClass(e).css("position","absolute").html("&nbsp;");this.$mirror.append(c,l,u).scrollTop(this.$text.scrollTop())},this.destroy=function(){return this.$mirror.remove(),this.$text.removeData(n),null},this.caretPos=function(){this.update();var t=this.$mirror.find("."+e),n=t.position();return"rtl"===this.$text.css("direction")&&(n.right=this.$mirror.innerWidth()-n.left-t.width(),n.left="auto"),n},this.height=function(){return this.update(),this.$mirror.css("height",""),this.$mirror.height()},this.getOriginalCaretPos=function(){var t=this.$text[0];if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var n=t.createTextRange(),i=n.duplicate();return n.moveToBookmark(e.getBookmark()),i.setEndPoint("EndToStart",n),i.text.length}return 0}}).call(o.prototype),t.fn.textareaHelper=function(e){return this.each((function(){var e=t(this),i=e.data(n);i||(i=new o(this),e.data(n,i))})),e?this.first().data(n)[e]():this}}));